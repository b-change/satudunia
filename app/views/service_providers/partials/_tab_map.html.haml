.content-wrapper
	#services_map{:style => "width:626px; height:360px"}



:javascript
	
	jQuery(document).ready(function($){
		var geocoder;
		var map;
		var markersArray = [];
		var bounds;
		var infowindow =  new google.maps.InfoWindow({
				content: ''
		});

		//plot initial point using geocode instead of coordinates (works just fine)
		function initialize() {
				geocoder = new google.maps.Geocoder();
				bounds = new google.maps.LatLngBounds ();

				var myOptions = {
						zoom: 2, 
						mapTypeId: google.maps.MapTypeId.ROADMAP,
					
				};
			
				map = new google.maps.Map(document.getElementById("services_map"), myOptions);

				plotMarkers();
		}
		
		var locationsArray = [['#{escape_javascript @service_provider.name.gsub(",","")}','#{escape_javascript @service_provider.description.gsub(",","")}' ,'#{escape_javascript @service_provider.telephone}' + " " + '#{escape_javascript @service_provider.email}','#{escape_javascript @service_provider.address.gsub(",","")}']]


		function plotMarkers(){
				var i;
				for(i = 0; i < locationsArray.length; i++){
						codeAddresses(locationsArray[i]);
				}
		}

		function codeAddresses(address){
				geocoder.geocode( { 'address': address[3]}, function(results, status) { 
						if (status == google.maps.GeocoderStatus.OK) {
								marker = new google.maps.Marker({
										map: map,
										position: results[0].geometry.location
								});

								google.maps.event.addListener(marker, 'click', function() {

										var formattedAddress =  "<b>" + address[0] + "</b> <br/>" + address[1] + "<br/>" +"<b>" + address[2] + "</b>" ;
										infowindow.setContent(formattedAddress);
										infowindow.open(map, this);
								});

								bounds.extend(results[0].geometry.location);

								markersArray.push(marker); 
						}
						else{
								alert("Geocode was not successful for the following reason: " + status);
						}

						map.fitBounds(bounds);
				});
		}

		google.maps.event.addDomListener(window, 'load', initialize);


	});